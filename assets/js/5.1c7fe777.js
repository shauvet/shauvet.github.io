(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{155:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("ul",[a("li",[a("p",[t._v("对于那些经常使用 react 的人来说，很难不遇到"),a("a",{attrs:{href:"https://reactjs.org/docs/higher-order-components.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("高阶组件"),a("OutboundLink")],1),t._v("(或者 HoC's)。对于外行来说，它是一种让 react 组合本身以让代码可以复用到不同的组件的一直模式。即使你没有自己写过，也很有可能在你没有意识到的时候使用过它们。")])]),a("li",[a("p",[t._v("常见的使用模式可以从连接项目工程与状态管理存储(例如： "),a("a",{attrs:{href:"https://www.sohamkamani.com/blog/2017/03/31/react-redux-connect-explained/",target:"_blank",rel:"noopener noreferrer"}},[t._v("redux"),a("OutboundLink")],1),t._v(" 里面的 "),a("code",[t._v("connect")]),t._v(")到"),a("a",{attrs:{href:"https://github.com/acdlite/recompose/blob/master/docs/API.md#branch",target:"_blank",rel:"noopener noreferrer"}},[t._v("条件渲染组件"),a("OutboundLink")],1),t._v("或者我最喜欢的模式即赋予函数组件本地状态。")])]),a("li",[a("p",[t._v("概念上来说，高阶组件是使用一些叫做增强器的函数包裹一个基础组件来组成的。增强器可以通过多种方式转换或者影响一个基础组件。这类似于 "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Map_%28higher-order_function%29",target:"_blank",rel:"noopener noreferrer"}},[t._v("map 函数"),a("OutboundLink")],1),t._v("，可以对一组数据进行转换并生成一组新的数据。如果你仍然有一点困惑，可以看下这个例子：")])]),t._m(1),t._m(2),t._m(3),a("li",[a("p",[t._v("这是一项简单的例子，展示了高阶组件是如何帮助我们写出高度组合性的代码。许多人想到"),a("a",{attrs:{href:"https://reactjs.org/docs/higher-order-components.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("高阶组件"),a("OutboundLink")],1),t._v("的时候，很难不想到一个非常可靠的增强器的库，"),a("a",{attrs:{href:"https://github.com/acdlite/recompose",target:"_blank",rel:"noopener noreferrer"}},[t._v("Recompose"),a("OutboundLink")],1),t._v("。每周140多万次下载，完全可以说它是一个很流行的纯粹地由高阶组件开发的库。这足以说明高阶组件的一些最佳应用。")])]),t._m(4),t._m(5),a("li",[a("p",[t._v("与 Recompose 的作者一起建造，hooks 被认为是各方面都比高阶组件更好的解决方案。甚至 Recompose 的作者更新了 "),a("a",{attrs:{href:"https://github.com/acdlite/recompose#a-note-from-the-author-acdlite-oct-25-2018",target:"_blank",rel:"noopener noreferrer"}},[t._v("readme"),a("OutboundLink")],1),t._v(" 建议人们转到 hooks。")]),t._m(6)]),t._m(7)]),t._m(8),a("ul",[a("li",[t._v("我喜欢尽可能的写函数组件。类组件随着尺寸增长会变得越来越难以预测以及难以维护。Recompose 提供了一种增强器通过一种方式来组合本地状态和函数组件，这让我不必为了如何写组件而妥协。而 hooks 从一开始就是被设计用在函数组件内解决这种问题的，hooks 改变了游戏。"),a("a",{attrs:{href:"https://reactjs.org/docs/hooks-reference.html#usestate",target:"_blank",rel:"noopener noreferrer"}},[t._v("useState"),a("OutboundLink")],1),t._v(" 钩子允许我所需要的所有状态管理逻辑，而且读写还非常简洁优雅。在之前的每一个使用 "),a("a",{attrs:{href:"https://github.com/acdlite/recompose/blob/master/docs/API.md#withstate",target:"_blank",rel:"noopener noreferrer"}},[t._v("withState"),a("OutboundLink")],1),t._v(" 的地方我全都直接换成了 "),a("code",[t._v("useState")]),t._v("。")])]),t._m(9),a("ul",[a("li",[t._v("又一次，hooks 赢了。"),a("a",{attrs:{href:"https://reactjs.org/docs/hooks-reference.html#useeffect",target:"_blank",rel:"noopener noreferrer"}},[t._v("useEffect"),a("OutboundLink")],1),t._v(" 简化了在组件中增加副作用的必要的理解。跟 "),a("code",[t._v("componentDidMount")]),t._v(" 和 "),a("code",[t._v("componentDidUpdate")]),t._v(" 不同，在一个推迟的事件中，被传递给 "),a("code",[t._v("useEffect")]),t._v(" 的函数在布局和绘图之后才会执行。这使得它很适合常见的副作用，如订阅 subscriptions 和事件处理器，因为大多数类型的工作不应该阻止浏览器更新屏幕。此外，"),a("code",[t._v("useEffect")]),t._v(" 提供了一种简单的方式来编写简洁的代码，这有助于组件渲染中在下一次作用执行之前清理前一次的作用。Recompose 和 "),a("a",{attrs:{href:"https://www.npmjs.com/package/@hocs/with-lifecycle",target:"_blank",rel:"noopener noreferrer"}},[t._v("withLifecycle"),a("OutboundLink")],1),t._v(" 提供了高阶组件的解法，但是没有提供 "),a("a",{attrs:{href:"https://reactjs.org/docs/hooks-reference.html#useeffect",target:"_blank",rel:"noopener noreferrer"}},[t._v("useEffect"),a("OutboundLink")],1),t._v(" 的简洁用法。我还没有达到这个生命周期高阶组件可以解决地更好的 hook 钩子的极限。")])]),t._m(10),a("ul",[a("li",[t._v("早期让我倾向于高阶组件的一个原因是他们可以模块化。模块化使得它们对单元测试非常友好。然而，hooks 这玩意并非是激情过后的产物。hooks是很多人花很多精力创造出来的。其中之一就是"),a("a",{attrs:{href:"https://reactjs.org/docs/hooks-faq.html#how-to-test-components-that-use-hooks",target:"_blank",rel:"noopener noreferrer"}},[t._v("可测试性"),a("OutboundLink")],1),t._v("。已经有正在积极维护的"),a("a",{attrs:{href:"https://github.com/mpeyper/react-hooks-testing-library",target:"_blank",rel:"noopener noreferrer"}},[t._v("很奇妙的库"),a("OutboundLink")],1),t._v("被用来测试 hooks。在这方面，两种模式在许多方面都是类似，然而，在某些方面可以证明这是必要的。")])]),t._m(11),a("ul",[t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),a("li",[a("p",[t._v("虽然它肯定有更多行，但是需要注意的是每个常量的模块性。"),a("a",{attrs:{href:"https://github.com/acdlite/recompose/blob/master/docs/API.md#branch",target:"_blank",rel:"noopener noreferrer"}},[t._v("branch"),a("OutboundLink")],1),t._v(" 是一个来自 Recompose 的增强器，它接收一个测试函数和两个高阶组件。测试函数从所有者那里传递属性。如果它返回 true，那么 "),a("code",[t._v("left")]),t._v(" 组件会被应用，否则，右边的组件会被应用。当我们把所有块组合起来时，表现跟之前一样。当我们考虑与以前相同的假设时，想想如何为数十个类似结构的请求测试，好处就变得明显了。我们需要测试一次 "),a("code",[t._v("withError")]),t._v(" 和 "),a("code",[t._v("withLoading")]),t._v("，我们可以复用这个逻辑很多次，当我们仍然想维持相同的测试覆盖率而无需写新的测试用例。")])])]),t._m(19),t._m(20),t._m(21),t._m(22)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"译-高阶组件在-react-hooks-中的应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#译-高阶组件在-react-hooks-中的应用","aria-hidden":"true"}},[this._v("#")]),this._v(" [译]高阶组件在 react hooks 中的应用")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// A simple component")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("HelloComponent")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("otherProps "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" \n                          "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("div "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("otherProps"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n                              Hello "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("\n                           "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// An enhancer that will set a name prop on ")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v('// a base component to "New Name"')]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("withNameOverride")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" BaseComponent "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" props "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                             "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("BaseComponent \n                                 "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("props"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                                 name"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v('"New Name"')]),t._v(" \n                              "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// An enhancer that will apply some inline")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// styling to a base component")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("withStyling")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" BaseComponent "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" props "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n                            "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("BaseComponent \n                                "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("props"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                                style"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                                        font"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("weight"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("700")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n                                        color"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'green'")]),t._v("\n                                       "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n                             "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// Higher Order Components")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EnhancedHello1 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("withNameOverride")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HelloComponent"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EnhancedHello2 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("withStyling")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HelloComponent"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EnhancedHello3 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("compose")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("withNameOverride"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" withStyling"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("HelloComponent"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("在这个片段中，"),s("code",[this._v("HelloComponent")]),this._v(" 是一个我们可以通过 "),s("code",[this._v("withNameOverride")]),this._v(" 和/或者 "),s("code",[this._v("withStyling")]),this._v(" 增强的组件。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("EnhancedHello1 name"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'World'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n"),a("span",{attrs:{class:"token comment"}},[t._v("//becomes")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello New "),a("span",{attrs:{class:"token class-name"}},[t._v("Name")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("EnhancedHello2 name"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'World'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n"),a("span",{attrs:{class:"token comment"}},[t._v("//becomes")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("div style"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" fontWeight"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("700")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("color"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'green'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello World"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("EnhancedHello3 name"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token string"}},[t._v("'World'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n"),a("span",{attrs:{class:"token comment"}},[t._v("//becomes")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("div style"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" fontWeight"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("700")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("color"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'green'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello New "),a("span",{attrs:{class:"token class-name"}},[t._v("Name")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("对许多 react 开发者来说，高阶组件是生态系统中必不可少的一部分。至少是在2018年10月之前，react 大会召开之前是这样的。在这次大会上 react 团队推出了 hooks。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("iframe",{attrs:{width:"700",height:"393",src:"https://www.youtube.com/embed/wXLf18DsV-I",frameborder:"0",allow:"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Hooks 解决了我三年前尝试使用 Recompose 解决的问题，不止如此。我将停止对此包 [Recompose] 的主动维护。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("这份声明强烈而且分裂了许多已经非常习惯使用 Recompose 的开发者(包括我自己)。我们已经使用高阶组件的可组合性开发了大量的应用，很难相信 hooks 能够神奇的全部替换掉它。这使我更加好奇是否仍然有在新的 react 开发中使用高阶组件的必要性。我列了几个我使用高阶组件的例子，以及他们如何在前 hooks 环境中叠加。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"组件本地状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件本地状态","aria-hidden":"true"}},[this._v("#")]),this._v(" 组件本地状态")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"组件生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" 组件生命周期")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"可测试性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可测试性","aria-hidden":"true"}},[this._v("#")]),this._v(" 可测试性")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"分支渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分支渲染","aria-hidden":"true"}},[this._v("#")]),this._v(" 分支渲染")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("考虑下这种情况：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[a("p",[t._v("你有一个组件接收 "),a("code",[t._v("bar")]),t._v(" 属性并且将它提供给一个函数，这个函数从一些请求返回 "),a("code",[t._v("{ results, loading, error }")]),t._v("。当 "),a("code",[t._v("loading")]),t._v(" 被定义的时候，你需要渲染一个 loading 提示组件。当 "),a("code",[t._v("error")]),t._v(" 被定义的时候，你需要渲染一个 error 组件。只有当 "),a("code",[t._v("loading")]),t._v(" 和 "),a("code",[t._v("error")]),t._v(" 都没有定义时，你才可以认为 "),a("code",[t._v("result")]),t._v(" 是合法的。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("hooks 的实现看起来像这样(假设 "),s("code",[this._v("useRequest")]),this._v(" 是一个使用 hooks 进行请求的非凡函数)：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("Foo")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bar "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" result"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loading"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("useRequest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("ErrorComponent "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loading"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("LoadingComponent "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("ResultComponent result"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("result"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("这初看起来挺合理的，但是如果我们不得不重复几十次不同的请求时是什么样呢？你可能会拷贝或粘贴这个条件块到每一个条件里面不同的应用，它可能需要在内部测试。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[this._v("一个高阶组件实现可以像这样重组：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("Foo")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" result "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("ResultComponent result"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("result"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("withRequest")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" BaseComponent "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("props "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" result"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loading"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("useRequest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bar"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("BaseComponent "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("props"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" result"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("result"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" loading"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("loading"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" error"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("error"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" withError "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("branch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" error "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" error"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ErrorComponent"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" withLoading "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("branch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" loading "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" loading"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LoadingComponent"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("compose")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  withRequest"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  withLoading"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  withError\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"属性转换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#属性转换","aria-hidden":"true"}},[this._v("#")]),this._v(" 属性转换")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[t._v("考虑下这种情况：")])]),a("li",[a("p",[t._v("你有一个组件，接收一个 "),a("code",[t._v("foo")]),t._v(" 属性，但是在被使用前要被转换为 "),a("code",[t._v("bar")]),t._v("。在咨询 Hooks API 的参考资料获取指导之后，我真的不知道 hooks 该如何解决这个问题(如果你正好指导如何使用 hooks 解决，请留言让我知道)。然而，这里有一个高阶组件的解决方案：")])]),a("li",[a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("Result")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" bar "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("ResultComponent result"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("bar"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{attrs:{class:"token function-variable function"}},[t._v("withBar")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" BaseComponent "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("props "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("BaseComponent "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("props"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" bar"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token function"}},[t._v("transform")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("withBar")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Result"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),a("li",[a("p",[t._v("而且即使在这种情况下 "),a("code",[t._v("withProps")]),t._v(" 也可以替换 "),a("code",[t._v("withBar")]),t._v(" 的很多应用。然而，为清晰起见，我选择更加精确的方案。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("比较高阶组件和 hooks 是一个天真的争论。hooks 的确可以以更加优雅的方式解决一些我们曾经只能通过高阶组件（使用 recompose ）处理的大的挑战。然而，如果你走近看，明显的是高阶组件在 react 中仍然有用武之地。")])]),s("li",[s("p",[this._v("在我的使用高阶组件的分支渲染的例子中，我试图使用同被使用在 hooks 的例子中相同的 "),s("code",[this._v("useRequest")]),this._v(" 函数。你有注意到吗？在任何情况下它都是兼容的。这里的目的是为了表明 hooks 可以很好地处理很多像状态和生命周期的这样大的概念，但是使用它的代码也可以从高阶组件的可组合性和模块性中受益。")])]),s("li",[s("p",[this._v("Recompose 的作者关于 hooks 的声明绝对是大胆的，但不完全是事实。如果有的话，应该是这样：")]),s("blockquote",[s("p",[this._v("Hooks 解决了许多我三年前试图用 Recompose 来解决的问题。由于这一点，一些工具现在不太有用了，因此我推荐大家看下 hooks。")])])]),s("li",[s("p",[this._v("那么回到文章的标题，Recompose 在 React Hooks  世界里的作用减少了，但是至少到目前为止，高阶组件仍然有用。")])])])}],!1,null,null,null);s.default=o.exports}}]);