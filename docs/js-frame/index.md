## 开发类 redux 库来理解状态管理

> 对于想要直接看结果，跳过文章的人，我已经把我写的内容制作成了一个库：[use-simple-state](https://github.com/Jahans3/use-simple-state)，无任何依赖（不像redux 还依赖 react ），只有3kb，相当轻量。

* 近几年，应我们的 app 增长的需要，web 应用数量增长迅速，随之而来的还有复杂性。为了使增加的复杂性易于处理，应用某些新增的技巧和模式使得开发者可以更简单的处理以及帮助我们建立更加健壮的应用。
* 其中一个复杂性增长的主要领域是管理我们应用的状态，因此为了避免这种复杂性，开发者使用了包含更新和获取 app 状态的库。最著名的例子是 redux，它是 flux 模式的一种应用。
* 一旦开发者开始学习使用像 redux 的库，他们可能不太了解库的内部运行机制，因为一开始这并不明显，即使很容易的知道了这是更新一个全局可用的对象这样的一个概念。
* 在这篇文章中，我们将会从零开始为 react 应用建立一个我们自己的状态管理解决方案。我们的解决方案最初只有几行代码，逐渐增加更高级的特性，最终将类似于 redux。

### 基本概念

* 任何状态管理工具只需要两件东西：对整个应用都可用的全局状态，和读取以及更新它的能力。只有这些，真的。
* 这里展示一个状态管理的简单例子：
```
const state = {};

export const getState = () => state;

export const setState = nextState => {
  state = nextState;
};
```
* 上面的例子已经尽可能的简单，但它仍然包含了所有的要素：
> 一个全局可用的用于展现我们应用状态的值：state；
>
> 读取状态的能力：getState；
>
> 更新状态的能力：setState。

* 上面的例子对于我们真实应用来说太过简单，因此接下来我们将要构建一个能让 react 可用的解决方案。首先我们来重构我们的例子，以让它在 react 中可用。

### react 状态管理

* 为了制作一个我们之前解决方案的 react 版本，我们需要应用两个 react 功能。第一个功能是普通经典类组件，也就是众所周知的有状态组件。
* 第二个功能是 context api，它可以让数据在整个 react 应用可用。context 有两部分：provider (生产者) 和 consumer (消费者)，provider 就像它的名字所说的那样，给应用提供 context (data 数据)，消费者意指当我们读取 context 时，我们就是消费者。
* 可以这样理解 context：如果说 props 是显式的传送数据，那么 context 就是隐式的传送数据。